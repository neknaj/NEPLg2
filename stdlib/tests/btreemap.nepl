//: btreemap: tests/btreemap.nepl に関する機能を提供するライブラリ
//:
//: [目的/もくてき]:
//: - このモジュールの公開 API を提供します。
//: - 実装の変更時に最小限の doctest 実行経路を維持します。
//:
//: [注意/ちゅうい]:
//: - 利用時は各関数の「目的」「注意」「計算量」を確認してください。
//:
//: neplg2:test[skip]
//: ```neplg2
//:| #entry main
//:| #target wasi
//: ()
//: ```

#entry main
#indent 4
#target wasi

#import "alloc/collections/btreemap" as *
#import "core/option" as *
#import "std/test" as *

//: main: 主な用途
//:
//: [目的/もくてき]:
//: - main の主な用途と呼び出し方を示します。
//:
//: [実装/じっそう]:
//: - 定義済み処理をそのまま呼び出す薄いラッパで構成されています。
//:
//: [注意/ちゅうい]:
//: - 引数の値は関数呼び出しで移動するため、再利用時は束縛し直してください。
//:
//: [計算量/けいさんりょう]:
//: - 本体処理に準じます。
fn main <()*> ()> ():
    let m0 <i32> btreemap_new<i32>
    assert_eq_i32 0 btreemap_len<i32> m0
    assert btreemap_is_empty<i32> m0
    assert_ne true btreemap_contains<i32> m0 1
    test_checked "new"

    assert is_none<i32> btreemap_insert<i32> m0 5 50
    assert is_none<i32> btreemap_insert<i32> m0 1 10
    assert is_none<i32> btreemap_insert<i32> m0 3 30
    assert_eq_i32 3 btreemap_len<i32> m0
    assert btreemap_contains<i32> m0 1
    assert btreemap_contains<i32> m0 3
    assert btreemap_contains<i32> m0 5
    assert_ne true btreemap_contains<i32> m0 2
    test_checked "insert"

    match btreemap_get<i32> m0 1:
        Option::Some v:
            assert_eq_i32 10 v
        Option::None:
            test_fail "btreemap_get 1 returned None"

    assert is_none<i32> btreemap_get<i32> m0 2

    match btreemap_insert<i32> m0 3 31:
        Option::Some v:
            assert_eq_i32 30 v
        Option::None:
            test_fail "insert update returned None"
    assert_eq_i32 3 btreemap_len<i32> m0
    test_checked "update"

    match btreemap_remove<i32> m0 1:
        Option::Some v:
            assert_eq_i32 10 v
        Option::None:
            test_fail "remove existing returned None"
    assert_eq_i32 2 btreemap_len<i32> m0
    assert is_none<i32> btreemap_get<i32> m0 1
    test_checked "remove"

    assert is_none<i32> btreemap_remove<i32> m0 42
    btreemap_clear<i32> m0
    assert_eq_i32 0 btreemap_len<i32> m0
    assert btreemap_is_empty<i32> m0
    assert_ne true btreemap_contains<i32> m0 5
    test_checked "clear"
    btreemap_free<i32> m0
    ()
