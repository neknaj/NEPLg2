//: rand: tests/rand.nepl に関する機能を提供するライブラリ
//:
//: [目的/もくてき]:
//: - このモジュールの公開 API を提供します。
//: - 実装の変更時に最小限の doctest 実行経路を維持します。
//:
//: [注意/ちゅうい]:
//: - 利用時は各関数の「目的」「注意」「計算量」を確認してください。
//:
//: neplg2:test[skip]
//: ```neplg2
//:| #entry main
//:| #target wasi
//: ()
//: ```

#entry test_rand
#indent 4
#import "core/rand/xorshift32" as *
#import "std/test" as *
#import "core/math" as *
#import "core/field" as *

//: test_rand: 主な用途
//:
//: [目的/もくてき]:
//: - test_rand の主な用途と呼び出し方を示します。
//:
//: [実装/じっそう]:
//: - 定義済み処理をそのまま呼び出す薄いラッパで構成されています。
//:
//: [注意/ちゅうい]:
//: - 引数の値は関数呼び出しで移動するため、再利用時は束縛し直してください。
//:
//: [計算量/けいさんりょう]:
//: - 本体処理に準じます。
fn test_rand <()*>i32> ():
    // Test 1: init non-zero
    let rng0 new_xorshift32 42

    // Test 2: generate multiple values
    let rng1 xorshift32_next rng0
    let v1 get rng1 "state"

    let rng2 xorshift32_next rng1
    let v2 get rng2 "state"

    let rng3 xorshift32_next rng2
    let v3 get rng3 "state"

    // and ideally different (probabilistic)
    assert_ne eq v1 0 true
    assert_ne eq v2 0 true
    assert_ne eq v1 v2 true

    // Test 3: init with 0 should be corrected
    let rng_z new_xorshift32 0
    let rng_z1 xorshift32_next rng_z
    let vz1 get rng_z1 "state"
    assert_ne eq vz1 0 true

    test_checked "rand tests passed"
    0
