//: hash: tests/hash.nepl に関する機能を提供するライブラリ
//:
//: [目的/もくてき]:
//: - このモジュールの公開 API を提供します。
//: - 実装の変更時に最小限の doctest 実行経路を維持します。
//:
//: [注意/ちゅうい]:
//: - 詳細な関数別ドキュメントは段階的に追記します。
//:
//: neplg2:test[skip]
//: ```neplg2
//:| #entry main
//:| #target wasi
//: ()
//: ```

#entry test_hash
#indent 4
#import "alloc/hash/fnv1a32" as *
#import "alloc/hash/sha256" as *
#import "std/test" as *
#import "alloc/vec" as *
#import "core/math" as *

//: test_hash: 関数の概要
//:
//: [目的/もくてき]:
//: - test_hash が担う機能を提供します。
//:
//: [実装/じっそう]:
//: - 前置記法・オフサイドルール前提で読みやすく保つ構造です。
//:
//: [注意/ちゅうい]:
//: - 型引数や所有権の制約は呼び出し側で満たしてください。
//:
//: [計算量/けいさんりょう]:
//: - 実装に依存します。
fn test_hash <()*>i32> ():
    // FNV-1a Test
    let h0 new_fnv1a32
    // Hash "a" (0x61 = 97)
    let h1 fnv1a32_update h0 97
    let result fnv1a32_finalize h1
    
    // Expected: (basis ^ 97) * prime
    // 0x811c9dc5 ^ 0x61 = 0x811c9da4
    // 0x811c9da4 * 0x01000193 = 0xe40c292c
    // 0xe40c292c = -468965076 (signed)
    assert_eq_i32 -468965076 result

    test_checked "fnv1a32 basic test passed"

    // SHA-256 Skeleton Test
    let s0 new_sha256
    let s1 sha256_update s0 10
    let s2 sha256_update s1 20
    let res_vec sha256_finalize s2
    
    assert_eq_i32 2 (vec_len<i32> res_vec)
    
    test_checked "sha256 skeleton test passed"
    0
