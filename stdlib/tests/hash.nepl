//: hash: tests/hash.nepl に関する機能を提供するライブラリ
//:
//: [目的/もくてき]:
//: - このモジュールの公開 API を提供します。
//: - 実装の変更時に最小限の doctest 実行経路を維持します。
//:
//: [注意/ちゅうい]:
//: - 利用時は各関数の「目的」「注意」「計算量」を確認してください。
//:
//: neplg2:test[skip]
//: ```neplg2
//:| #entry main
//:| #target wasi
//: ()
//: ```

#entry test_hash
#indent 4
#import "alloc/hash/fnv1a32" as *
#import "alloc/hash/sha256" as *
#import "std/test" as *
#import "alloc/vec" as *
#import "core/math" as *

//: test_hash: 主な用途
//:
//: [目的/もくてき]:
//: - test_hash の主な用途と呼び出し方を示します。
//:
//: [実装/じっそう]:
//: - 定義済み処理をそのまま呼び出す薄いラッパで構成されています。
//:
//: [注意/ちゅうい]:
//: - 引数の値は関数呼び出しで移動するため、再利用時は束縛し直してください。
//:
//: [計算量/けいさんりょう]:
//: - 本体処理に準じます。
fn test_hash <()*>i32> ():
    // FNV-1a Test
    let h0 new_fnv1a32
    // Hash "a" (0x61 = 97)
    let h1 fnv1a32_update h0 97
    let result fnv1a32_finalize h1
    
    // Expected: (basis ^ 97) * prime
    // 0x811c9dc5 ^ 0x61 = 0x811c9da4
    // 0x811c9da4 * 0x01000193 = 0xe40c292c
    // 0xe40c292c = -468965076 (signed)
    assert_eq_i32 -468965076 result

    test_checked "fnv1a32 basic test passed"

    // SHA-256 Skeleton Test
    let s0 new_sha256
    let s1 sha256_update s0 10
    let s2 sha256_update s1 20
    let res_vec sha256_finalize s2
    
    assert_eq_i32 2 (vec_len<i32> res_vec)
    
    test_checked "sha256 skeleton test passed"
    0
