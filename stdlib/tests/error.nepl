//: error: tests/error.nepl に関する機能を提供するライブラリ
//:
//: [目的/もくてき]:
//: - このモジュールの公開 API を提供します。
//: - 実装の変更時に最小限の doctest 実行経路を維持します。
//:
//: [注意/ちゅうい]:
//: - 詳細な関数別ドキュメントは段階的に追記します。
//:
//: neplg2:test[skip]
//: ```neplg2
//:| #entry main
//:| #target wasi
//: ()
//: ```

#entry main
#indent 4
#target wasi

#import "alloc/diag/error" as *
#import "alloc/diag/diag" as *
#import "core/math" as *
#import "alloc/string" as *
#import "std/test" as *

//: main: 関数の概要
//:
//: [目的/もくてき]:
//: - main が担う機能を提供します。
//:
//: [実装/じっそう]:
//: - 前置記法・オフサイドルール前提で読みやすく保つ構造です。
//:
//: [注意/ちゅうい]:
//: - 型引数や所有権の制約は呼び出し側で満たしてください。
//:
//: [計算量/けいさんりょう]:
//: - 実装に依存します。
fn main <()*> ()> ():
    // Test error_new formatting
    let e1 <Error> error_new ErrorKind::Failure "test failure";
    let s1 <str> diag_to_string e1;
    assert_str_eq "error[Failure]: test failure\n" s1;

    let e2 <Error> error_new ErrorKind::OutOfMemory "ran out of memory";
    let s2 <str> diag_to_string e2;
    assert_str_eq "error[OutOfMemory]: ran out of memory\n" s2;

    // Test error_with_span formatting
    let sp <Span> Span 4 5 6;
    let e3 <Error> error_new ErrorKind::Failure "with span";
    let e4 <Error> error_with_span e3 sp;
    let s3 <str> diag_to_string e4;
    assert_str_eq "error[Failure]: with span\nat 4:5-6\n" s3;

    // Test error_new returns a non-empty diagnostic
    let ef <Error> error_new ErrorKind::Failure "boom";
    let sf <str> diag_to_string ef;
    assert gt len sf 0;

    ()
