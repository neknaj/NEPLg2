//: diag: tests/diag.nepl に関する機能を提供するライブラリ
//:
//: [目的/もくてき]:
//: - このモジュールの公開 API を提供します。
//: - 実装の変更時に最小限の doctest 実行経路を維持します。
//:
//: [注意/ちゅうい]:
//: - 利用時は各関数の「目的」「注意」「計算量」を確認してください。
//:
//: neplg2:test[skip]
//: ```neplg2
//:| #entry main
//:| #target wasi
//: ()
//: ```

#entry main
#indent 4
#target wasi

#import "alloc/diag/diag" as *
#import "alloc/diag/error" as *
#import "std/test" as *

//: main: 主な用途
//:
//: [目的/もくてき]:
//: - main の主な用途と呼び出し方を示します。
//:
//: [実装/じっそう]:
//: - 定義済み処理をそのまま呼び出す薄いラッパで構成されています。
//:
//: [注意/ちゅうい]:
//: - 引数の値は関数呼び出しで移動するため、再利用時は束縛し直してください。
//:
//: [計算量/けいさんりょう]:
//: - 本体処理に準じます。
fn main <()*> ()> ():
    // Test kind_str for various error kinds
    assert_str_eq "Failure" kind_str ErrorKind::Failure;
    assert_str_eq "OutOfMemory" kind_str ErrorKind::OutOfMemory;
    assert_str_eq "IndexOutOfBounds" kind_str ErrorKind::IndexOutOfBounds;
    assert_str_eq "KeyNotFound" kind_str ErrorKind::KeyNotFound;
    assert_str_eq "ParseError" kind_str ErrorKind::ParseError;
    assert_str_eq "IoError" kind_str ErrorKind::IoError;
    assert_str_eq "Other" kind_str ErrorKind::Other;

    let e <Error> error_new ErrorKind::Failure "oops";
    let s <str> diag_to_string e;
    assert_str_eq "error[Failure]: oops\n" s;

    let sp <Span> Span 1 2 3;
    let e1 <Error> error_new ErrorKind::Failure "oops";
    let e2 <Error> error_with_span e1 sp;
    let s2 <str> diag_to_string e2;
    assert_str_eq "error[Failure]: oops\nat 1:2-3\n" s2;

    ()
