#entry main
#indent 4
#target wasi

#import "std/list" as *
#import "std/option" as *
#import "std/test" as *
#import "std/stdio" as *

fn main <()*> ()> ():
    // Test list_nil
    let l0 <i32> list_nil<i32>;
    assert_eq_i32 0 list_len<i32> l0;
    println "Checked nil"

    // Test list_cons and list_len
    let l1 <i32> list_cons<i32> 10 l0;
    assert_eq_i32 1 list_len<i32> l1;

    let l2 <i32> list_cons<i32> 20 l1;
    assert_eq_i32 2 list_len<i32> l2;

    let l3 <i32> list_cons<i32> 30 l2;
    assert_eq_i32 3 list_len<i32> l3;
    println "Checked len"

    // Test list_get on valid indices
    match list_get<i32> l3 0:
        Option::Some x:
            assert_eq_i32 30 x
        Option::None:
            trap;

    match list_get<i32> l3 1:
        Option::Some x:
            assert_eq_i32 20 x
        Option::None:
            trap;

    match list_get<i32> l3 2:
        Option::Some x:
            assert_eq_i32 10 x
        Option::None:
            trap;

    // Test list_get on out of bounds
    assert is_none<i32> list_get<i32> l3 3;
    assert is_none<i32> list_get<i32> l3 100;

    // Test list_get on negative index
    assert is_none<i32> list_get<i32> l3 -1;

    // Test list_head and list_tail
    match list_head<i32> l3:
        Option::Some x:
            assert_eq_i32 30 x
        Option::None:
            trap;

    println "Checked head"
    let l3_tail <i32> list_tail<i32> l3;
    match list_head<i32> l3_tail:
        Option::Some x:
            assert_eq_i32 20 x
        Option::None:
            trap;

    // Test list_reverse
    println "Checked tail"
    let l_rev <i32> list_reverse<i32> l3;
    match list_get<i32> l_rev 0:
        Option::Some x:
            assert_eq_i32 10 x
        Option::None:
            trap;

    match list_get<i32> l_rev 2:
        Option::Some x:
            assert_eq_i32 30 x
        Option::None:
            trap;

    println "Checked reverse"
    list_free<i32> l3;
    ()

