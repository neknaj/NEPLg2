//: list: tests/list.nepl に関する機能を提供するライブラリ
//:
//: [目的/もくてき]:
//: - このモジュールの公開 API を提供します。
//: - 実装の変更時に最小限の doctest 実行経路を維持します。
//:
//: [注意/ちゅうい]:
//: - 利用時は各関数の「目的」「注意」「計算量」を確認してください。
//:
//: neplg2:test[skip]
//: ```neplg2
//:| #entry main
//:| #target wasi
//: ()
//: ```

#entry main
#indent 4
#target wasi

#import "alloc/collections/list" as *
#import "core/option" as *
#import "std/test" as *

//: main: 主な用途
//:
//: [目的/もくてき]:
//: - main の主な用途と呼び出し方を示します。
//:
//: [実装/じっそう]:
//: - 定義済み処理をそのまま呼び出す薄いラッパで構成されています。
//:
//: [注意/ちゅうい]:
//: - 引数の値は関数呼び出しで移動するため、再利用時は束縛し直してください。
//:
//: [計算量/けいさんりょう]:
//: - 本体処理に準じます。
fn main <()*> ()> ():
    // Test list_nil
    let l0 <i32> list_nil<i32>;
    assert_eq_i32 0 list_len<i32> l0;
    test_checked "nil"

    // Test list_cons and list_len
    let l1 <i32> list_cons<i32> 10 l0;
    assert_eq_i32 1 list_len<i32> l1;

    let l2 <i32> list_cons<i32> 20 l1;
    assert_eq_i32 2 list_len<i32> l2;

    let l3 <i32> list_cons<i32> 30 l2;
    assert_eq_i32 3 list_len<i32> l3;
    test_checked "len"

    // Test list_get on valid indices
    match list_get<i32> l3 0:
        Option::Some x:
            assert_eq_i32 30 x
        Option::None:
            test_fail "list_get 0 returned None";

    match list_get<i32> l3 1:
        Option::Some x:
            assert_eq_i32 20 x
        Option::None:
            test_fail "list_get 1 returned None";

    match list_get<i32> l3 2:
        Option::Some x:
            assert_eq_i32 10 x
        Option::None:
            test_fail "list_get 2 returned None";

    // Test list_get on out of bounds
    assert is_none<i32> list_get<i32> l3 3;
    assert is_none<i32> list_get<i32> l3 100;

    // Test list_get on negative index
    assert is_none<i32> list_get<i32> l3 -1;

    // Test list_head and list_tail
    match list_head<i32> l3:
        Option::Some x:
            assert_eq_i32 30 x
        Option::None:
            test_fail "list_head returned None";

    test_checked "head"
    match list_tail<i32> l3:
        Option::Some l3_tail:
            match list_head<i32> l3_tail:
                Option::Some x:
                    assert_eq_i32 20 x
                Option::None:
                    test_fail "list_head tail returned None";
        Option::None:
            test_fail "list_tail returned None";

    // Test list_reverse
    test_checked "tail"
    let l_rev <i32> list_reverse<i32> l3;
    match list_get<i32> l_rev 0:
        Option::Some x:
            assert_eq_i32 10 x
        Option::None:
            test_fail "list_get reverse 0 returned None";

    match list_get<i32> l_rev 2:
        Option::Some x:
            assert_eq_i32 30 x
        Option::None:
            test_fail "list_get reverse 2 returned None";

    test_checked "reverse"
    list_free<i32> l3;
    ()
