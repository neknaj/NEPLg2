//: vec: tests/vec.nepl に関する機能を提供するライブラリ
//:
//: [目的/もくてき]:
//: - このモジュールの公開 API を提供します。
//: - 実装の変更時に最小限の doctest 実行経路を維持します。
//:
//: [注意/ちゅうい]:
//: - 詳細な関数別ドキュメントは段階的に追記します。
//:
//: neplg2:test[skip]
//: ```neplg2
//:| #entry main
//:| #target wasi
//: ()
//: ```

#entry main
#indent 4
#target wasi

#import "alloc/vec" as *
#import "core/cast" as *
#import "core/option" as *
#import "std/test" as *

//: main: 関数の概要
//:
//: [目的/もくてき]:
//: - main が担う機能を提供します。
//:
//: [実装/じっそう]:
//: - 前置記法・オフサイドルール前提で読みやすく保つ構造です。
//:
//: [注意/ちゅうい]:
//: - 型引数や所有権の制約は呼び出し側で満たしてください。
//:
//: [計算量/けいさんりょう]:
//: - 実装に依存します。
fn main <()*> ()> ():
    let v0 vec_new<i32>;
    assert vec_is_empty<i32> v0;

    let v1 vec_new<i32>;
    let v2 vec_push<i32> v1 10;
    assert_eq_i32 1 vec_len<i32> v2;

    let v3 vec_new<i32>;
    let v4 vec_push<i32> v3 10;
    let v5 vec_push<i32> v4 20;
    let v6 vec_push<i32> v5 30;
    assert_eq_i32 3 vec_len<i32> v6;

    let g0 vec_new<i32>;
    let g1 vec_push<i32> g0 10;
    let g2 vec_push<i32> g1 20;
    match vec_get<i32> g2 0:
        Option::Some x:
            assert_eq_i32 10 x
        Option::None:
            test_fail "vec_get 0 returned None";

    let h0 vec_new<i32>;
    let h1 vec_push<i32> h0 10;
    let h2 vec_push<i32> h1 20;
    match vec_get<i32> h2 1:
        Option::Some x:
            assert_eq_i32 20 x
        Option::None:
            test_fail "vec_get 1 returned None";

    let o0 vec_new<i32>;
    let o1 vec_push<i32> o0 10;
    assert is_none<i32> vec_get<i32> o1 2;

    let p0 vec_new<i32>;
    let p1 vec_push<i32> p0 10;
    assert is_none<i32> vec_get<i32> p1 -1;

    let b0 vec_new<u8>;
    let b1 vec_push<u8> b0 cast 65;
    match vec_get<u8> b1 0:
        Option::Some x:
            assert_eq_i32 65 cast x
        Option::None:
            test_fail "vec_get<u8> returned None";

    ()
