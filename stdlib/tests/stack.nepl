#entry main
#indent 4
#target wasi

#import "alloc/collections/stack" as *
#import "core/mem" as *
#import "core/option" as *
#import "std/test" as *

fn main <()*> ()> ():
    // Test stack_new
    let s stack_new<.i32>;
    assert_eq_i32 0 stack_len<.i32> s;

    // Test stack_push and stack_len
    stack_push<.i32> s 100;
    assert_eq_i32 1 stack_len<.i32> s;

    stack_push<.i32> s 200;
    assert_eq_i32 2 stack_len<.i32> s;

    stack_push<.i32> s 300;
    assert_eq_i32 3 stack_len<.i32> s;

    // Test stack_peek (top element without removing)
    match stack_peek<.i32> s:
        Option::Some x:
            assert_eq_i32 300 x
        Option::None:
            test_fail "stack_peek returned None";

    // stack_len should still be 3 after peek
    assert_eq_i32 3 stack_len<.i32> s;

    // Test stack_pop (remove top element)
    match stack_pop<.i32> s:
        Option::Some x:
            assert_eq_i32 300 x
        Option::None:
            test_fail "stack_pop 1 returned None";

    assert_eq_i32 2 stack_len<.i32> s;

    // Test stack_pop again
    match stack_pop<.i32> s:
        Option::Some x:
            assert_eq_i32 200 x
        Option::None:
            test_fail "stack_pop 2 returned None";

    // Test stack_pop on empty should return None
    match stack_pop<.i32> s:
        Option::Some x:
            assert_eq_i32 100 x
        Option::None:
            test_fail "stack_pop 3 returned None";

    match stack_pop<.i32> s:
        Option::Some x:
            test_fail "stack_pop on empty returned Some"
        Option::None:
            ();

    ()
